!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n,i=t();for(n in i)("object"==typeof exports?exports:e)[n]=i[n]}}(self,()=>(()=>{"use strict";var e={r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t);const u={name:"pinyin",text:"拼音",icon:"pinyin",tooltip:"拼音"};function y({editor:e,chinese:t}){const n=e.dom.create("span",{class:"xe-tianzige"});e=e.dom.create("span",{class:"xe-tianzige__text","data-placeholder":"1"},t);return n.append(e),n}function h({editor:e,chinese:t,pinyin:n}){const i=e.dom.create("span",{class:"xe-pinyin"}),o=e.dom.create("ruby");t=e.dom.create("span",{class:"xe-pinyin__text","data-placeholder":"1"},t),e=e.dom.create("rt",null,n);return o.append(t),o.append(e),i.append(o),i}function o({editor:i,data:e}){let{pinyin:t="",chinese:n="",showTianzige:o=!0}=e||{};var a;n=(a=n,p=new RegExp(/[\u4E00-\u9FA5\uF900-\uFA2D\u0020]+/,"g"),null!==a&&""!==a?a.match(p)?.join("")??"":""),t=t?.trim();const r=i.dom.createFragment(),d=(a=[{editor:i}["editor"]][0],a.dom.create("span",{class:"xe-pinyin-group",contenteditable:!1,"data-name":u.name})),c=n?n.split(""):[],l=t?t.split(" "):[];var p=c.length;const s=l.length,m=p>=s?c:l;return m.length?(m.forEach((e,t)=>{t={editor:i,chinese:c[t],pinyin:l[t]||"&nbsp;"};let n;n=(o?s?function({editor:e,chinese:t,pinyin:n}){const i=h({editor:e,chinese:t,pinyin:n}),o=(n=y({editor:e,chinese:t}),i.querySelector("ruby"));return o.firstChild.remove(),o.prepend(n),i}:y:h)(t),r.append(n)}),d.append(r),i.dom.setAttribs(d,{"data-content":JSON.stringify(e)}),i.dom.getOuterHTML(d)):""}class r{constructor({editor:e}){this.editor=e,this.previewId=e.dom.uniqueId()}open({target:e}={}){const{editor:t,previewId:n}=this;let i=null;e&&(e=t.dom.getAttrib(e,"data-content"))&&(i=JSON.parse(e)),t.windowManager.open({title:u.text,body:{type:"panel",items:[{type:"label",label:"中文",items:[{type:"input",name:"chinese"}]},{type:"label",label:"拼音",items:[{type:"input",name:"pinyin"}]},{type:"checkbox",label:"显示田字格",name:"showTianzige"},{type:"label",label:"",items:[{type:"htmlpanel",html:t.dom.createHTML("div",{id:n,class:"xe-dialog-preview"})}]}]},initialData:{showTianzige:i?.showTianzige??!0,pinyin:i?.pinyin??"",chinese:i?.chinese??""},buttons:[{type:"cancel",name:"cancel",text:"取消"},{type:"submit",name:"ok",text:"确定",primary:!0}],onChange:e=>{document.getElementById(n).innerHTML=o({editor:t,data:e.getData()})},onSubmit:e=>{t.execCommand("mceInsertContent",!1,o({editor:t,data:e.getData()})),e.close()}}),document.getElementById(n).innerHTML=o({editor:t,data:i})}}return tinymce.PluginManager.add(u.name,function(e){var i,t;i=e,i.on("BeforeSetContent",e=>{const t=i.dom.create("div",null,e?.content??""),n=t.querySelectorAll('[data-placeholder="1"]');n.forEach(e=>{e.innerHTML||e.append((e=[{editor:i}["editor"]][0],e.dom.create("span",{hidden:"hidden","data-name":"placeholder"},"placeholder")))}),e.content=t.innerHTML}),i.on("GetContent",e=>{const t=i.dom.create("div",null,e?.content??""),n=t.querySelectorAll('[data-name="placeholder"]');n.forEach(e=>{e.remove()}),e.content=t.innerHTML});{var n=e;let t=null;function o(e){t=new r({editor:n})}function a(){t.open()}n.ui.registry.addButton(u.name,{text:u.text,icon:u.icon,tooltip:u.tooltip,onAction:a,onSetup:o}),n.ui.registry.addMenuItem(u.name,{text:u.text,icon:u.icon,onAction:a,onSetup:o})}return t=[{editor:e}["editor"]][0],t.on("dblclick",e=>{e=t.dom.getParent(e.target,`[data-name="${u.name}"]`);e&&new r({editor:t}).open({target:e})}),{getMetaData:()=>({name:u.name})}}),t})());